{% extends "../layout.twig" %}
{% block title %} Lista de usuarios {% endblock %}

{% block main_container %}
    <h1>Bienvenido, {{ isLogedIn }}</h1>
    <h4>En la siguiente tabla puedes encontrar la lista de usuarios del sistema:</h4>
    <table class="table table-hover" id="tableUsers">
        <thead>
        <tr>
            <th scope="col" >Email</th>
            <th scope="col">Nombre</th>
            <th scope="col">Apellidos</th>
            {% if admin %}
                <th>Eliminar</th>
            {% else %}
                <th scope="col">Invitaci√≥n</th>
            {% endif %}

        </tr>
        </thead>
        <tbody>
        {% for user in users %}
        <tr>
            <td >{{ user.email }}</td>
            <td >{{ user.name }}</td>
            <td >{{ user.surname }}</td>
            {% if admin %}
                <td ><input type="checkbox" id="{{user._id}}"></td>
            {% else %}
                <td >
                    <button>
                        -Amistad-
                    </button>
                </td>
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% if admin %}
    <button type="button" id="deleteButton" class="btn btn-danger"> Borrar </button>
    {% endif %}
    <script >
        /*<![CDATA[*/

        $( "#deleteButton" ).click(function() {
            var usersToDelete = new Array();
            $("input:checkbox:checked").each(function(){
                usersToDelete.push($(this).attr('id')); //we insert id of user whose checkbox is checked.
            });
            var urlDelete = '/users/list/delete/';
            for (var i = 0; i < usersToDelete.length; i++) {
                if(i== usersToDelete.length-1){
                    urlDelete += usersToDelete[i].toString();
                }else{
                    urlDelete += usersToDelete[i].toString() + ",";
                }
            }

            location.replace(urlDelete);
        });
        /*]]>*/
    </script>
    <div class="row text-center">
        <ul class="pagination">
            {%for page in pages %}
                <li class="page-item" id="pi-{{ page }}"><a class="page-link" href="/users/list/?page={{ page }}">{{ page }}</a></li>
            {% endfor %}
            <script>
                $("#pi-" + "{{ currentPage }}").addClass("active");
            </script>
        </ul>
    </div>

{% endblock %}